- 정의
	- 주어진 데이터의 구간 합과 데이터 업데이트를 빠르게 수행하기 위해 고안해낸 자료구조
	- 더 큰 범위는 '인덱스 트리' 라고 불린다
	- 합배열을 이용하여 문제를 해결할 수 있지만  업데이트가 느리기 때문에 이를 해결하기 위해 고안된 자료구조이다
- 핵심 이론
	- 종류는 구간 합, 최대, 최소 구하기로 나눌 수 있다
	- 구현 단계는 트리 초기화 하기, 질의 값 구하기(구간 합 또는 최대, 최소), 데이터 업데이트 하기로 나눌 수 있다
- 구현
	1. 초기화 하기
		- 리프 노드의 개수가 데이터의 개수(N) 이상이 되도록 이진 트리 배열을 만든다
		- 트리 배열의 크기를 구하는 방법은 2^k >= N을 만족하는 k의 최소값을 구한 후 2^k * 2 를 트리 배열의 크기로 정한다
		- 리프 노드에 원본 데이터를 입력하는데, 리프노드의 시작 위치를 트리 배열의 인덱스로 구하는 방법은 2^k를 시작 인덱스로 취하면 된다 ![[Pasted image 20240402142429.png]]
		- 리프 노드를 제외한 나머지 노드값을 채워야 하는데 이는 트리의 부모와 자식의 특성을 이용해서 채울것이다(부모의 노드 * 2, 부모의 노드 * 2 + 1 을 하면 자식 노드를 구할 수 있다는 특성)
		- 구간합, 최대 ,최소에 따라 부모 노드에 값을 넣어줄 것인데 밑의 그림처럼 구간 합은 자식 노드의 합을 부모 노드에 넣어주면 되고, 최대, 최소는 자식들을 비교해 부모 노드에 넣어주면 된다![[Pasted image 20240402142618.png]]
		- 구성한 트리 배열을 트리 모양으로 구조화 하면 이처럼 표현할 수 있다![[Pasted image 20240402143353.png]]
	2. 질의 값 구하기
		- 주어진 질의 인덱스를 세그먼트 트리의 리프 노드에 해당하는 인덱스로 변경한다
		- 세그먼트 트리 index = 주어진 질의 index + 2^k - 1을 이용하여 질의 index 값을 구해준다
		- ![[Pasted image 20240402144113.png]]
			- start_index는 질의 index의 첫번째 값, end_index는 질의 index의 마지막 값
			- 3,4번은 부모 노드로 간다는 의미이다
			- start, end index 노드를 선택한 것은 해당 index의 노드의 부모 노드가 나타내는 범위가 질의 범위를 넘어가기 때문에 해당 index 노드를 독립 노드로 선택하여 해당 노드의 부모 노드를 대상 범위에서 제외시킨다
			- 부모 노드를 대상 범위에서 제외하는 방법이 3~4 과정으로, 부모 노드로 이동하기 위해 인덱스 연산을 index / 2가 아닌 (index+1)/2, (index-1)/2로 수행하는 것이다
			- 질의에 해당하는 노드를 선택하는 방법은 구간 합, 최대, 최소 구하기 모두 동일하며, 선택된 노드들에 관해 마지막 연산 방법만 다르다![[Pasted image 20240402144848.png]]
	3. 데이터 업데이트![[Pasted image 20240402153240.png]]
		- 업데이트 방식은 자신의 부모 노드로 이동하면서 업데이트 하는 것으로 동일하지만, 트리 타입별로 조금씩 다르다
		- 구간 합은 원래 데이터와 변경 데이터의 차이만큼 부모 노드로 올라가면서 변경
		- 최대 값은 자신과 같은 부모를 갖는 노드와 비교해 값이 큰 값으로 변경
		- 최소 값은 반대로 작은 값으로 변경
		- 이를 반복하다가 업데이트가 일어나지 않으면 종료한다
- 정리
	1. 세그먼트 트리 단계
		1. 트리 초기화 
			1. 크기 정하기: 2^k >=N를 찾아 2^k * 2
		2. 부모 노드 값 채우기
	2. 질의 값 구하기
		1. 질의 인덱스를 트리에 맞게 변경
		2. start, end 선택
	3. 데이터 업데이트